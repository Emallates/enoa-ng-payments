{"version":3,"sources":["webpack:///webpack/bootstrap 6c0f6e7c7b9665257738","webpack:///./src/providers/stripe/stripe.module.js","webpack:///./src/providers/stripe/stripe.provider.js","webpack:///./src/providers/stripe/stripe.http.service.js","webpack:///./src/providers/stripe/stripe.source.service.js","webpack:///./src/providers/stripe/stripe.directives.js","webpack:///./src/providers/stripe/directives/index.js","webpack:///./src/providers/stripe/directives/add-card.js"],"names":["angular","module","provider","service","stripeConfigProvider","API_KEY","BASE_URL","DEFAULTS","add_card_amount","currency","redirect","set","configs","defaults","apiKey","baseUrl","extend","stripeConfig","key","base_url","$get","stripeConfigFactory","httpService","$http","$httpParamSerializerJQLike","options","callback","data","auth","url","indexOf","headers","then","R","status","catch","ERR","error","$inject","forEach","hopArr","arr","stripeSource","$q","redirect_url","window","location","href","requestObject","newCard","type","card","val","billing_add","aVal","aKey","mVal","mKey","success","fail","create3DSecureCallback","create3DSecure","doRequest","method","cardResponse","three_d_secure","_3D","amount","id","return_url","stripe3dsCallback","makeIFrame","charge","r","stripe3dsResponse","tElm","targetElement","element","append","innerHTML","nativeElement","poolingCallback","poolCallback","watchSource","client_secret","onFinish","source","directive","Factory","defMap","addCard","default","restrict","scope","onSuccess","onFail","template","$scope","iElm","iAttrs","noop","save","createCard"],"mappings":"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","file":"stripe.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, {\n \t\t\t\tconfigurable: false,\n \t\t\t\tenumerable: true,\n \t\t\t\tget: getter\n \t\t\t});\n \t\t}\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 0);\n\n\n\n// WEBPACK FOOTER //\n// webpack/bootstrap 6c0f6e7c7b9665257738","/**\r\n* stripe Module\r\n*\r\n* Stripe service provider\r\n*/\r\nimport stripeProvider from \"./stripe.provider.js\";\r\nimport httpService from \"./stripe.http.service.js\";\r\nimport stripeSource from \"./stripe.source.service.js\";\r\nimport stripeDirectives from \"./stripe.directives.js\";\r\n\r\n\r\nexport default angular.module('stripe', ['stripe.directives'])\r\n  .provider('stripeConfig', stripeProvider)\r\n  .service('httpService', httpService)\r\n  .service('stripeSource', stripeSource)\r\n  ;\n\n\n// WEBPACK FOOTER //\n// ./src/providers/stripe/stripe.module.js","/**\r\n * @todo Improve this code\r\n */\r\n\r\nfunction stripeConfigProvider() {\r\n  var API_KEY = false;\r\n  var BASE_URL = 'https://api.stripe.com/v1'\r\n  var DEFAULTS = {\r\n    add_card_amount: 100,\r\n    currency: 'usd',\r\n    redirect: null\r\n  }\r\n\r\n  this.set = (configs, defaults) => {\r\n    API_KEY = configs.apiKey;\r\n    if (configs.baseUrl) BASE_URL = configs.baseUrl;\r\n    DEFAULTS = angular.extend({}, DEFAULTS, defaults);\r\n  };\r\n\r\n  function stripeConfig(key, base_url, defaults) {\r\n    this.key = key;\r\n    this.base_url = base_url;\r\n    this.defaults = defaults;\r\n  }\r\n\r\n  this.$get = [function stripeConfigFactory() {\r\n\r\n    // let's assume that the stripeConfig constructor was also changed to\r\n    // accept and use the key argument\r\n    return new stripeConfig(API_KEY, BASE_URL, DEFAULTS);\r\n  }];\r\n}\r\n// module.exports = stripeConfigProvider;\r\nexport default stripeConfigProvider;\r\n\n\n\n// WEBPACK FOOTER //\n// ./src/providers/stripe/stripe.provider.js","\r\nclass httpService {\r\n  constructor($http, $httpParamSerializerJQLike, stripeConfig) {\r\n    this.$http = $http;\r\n    this.stripeConfig = stripeConfig;\r\n    this.$httpParamSerializerJQLike = $httpParamSerializerJQLike;\r\n  }\r\n  doRequest(options, callback) {\r\n    const configs = this.stripeConfig;\r\n    if (options.data) options.data.key = configs.key;\r\n\r\n    options.auth = false;\r\n    options.url = (options.url.indexOf(configs.base_url) === -1)\r\n      ? `${configs.base_url}${options.url}`\r\n      : options.url;\r\n    options.data = this.$httpParamSerializerJQLike(options.data);\r\n    options.headers = angular.extend({ 'Content-Type': 'application/x-www-form-urlencoded' }, options.headers, { auth: false });\r\n    return (typeof callback !== 'function')\r\n    ? this.$http(options)\r\n    : this.$http(options)\r\n        .then(R => callback(R.status, R.data))\r\n        .catch(ERR => callback(ERR.status, (ERR.error || ERR.data || ERR)))\r\n  }\r\n}\r\n\r\nhttpService.$inject = ['$http', '$httpParamSerializerJQLike', 'stripeConfig'];\r\n\r\nexport default httpService;\r\n\n\n\n// WEBPACK FOOTER //\n// ./src/providers/stripe/stripe.http.service.js","/**\r\n* stripe.source Module\r\n*\r\n* Deal with stripe sources\r\n* @see [description]\r\n*/\r\n\r\nconst extend = angular.extend;\r\nconst forEach = angular.forEach;\r\nconst hopArr = (arr, key) => arr.indexOf(key) > -1;\r\n\r\nclass stripeSource {\r\n  constructor(httpService, stripeConfig, $q) {\r\n    this.$q = $q;\r\n    this.httpService = httpService;\r\n    this.stripeConfig = stripeConfig;\r\n    this.defaults = extend({\r\n      currency: 'usd',\r\n      redirect_url: window.location.href,\r\n      add_card_amount: 100,\r\n    }, stripeConfig.defaults)\r\n  }\r\n  createCard(requestObject) {\r\n    const newCard = {\r\n      type: 'card'\r\n    };\r\n    forEach(requestObject.card, (val, key) => {\r\n      if (hopArr['number', 'cvc', 'exp_month', 'exp_year'], key) {\r\n        newCard[`card[${key}]`] = val;\r\n      }\r\n    });\r\n    if (requestObject.billing_add) {\r\n      forEach(requestObject.billing_add, (val, key) => {\r\n        if (hopArr(['email', 'name', 'phone'], key)) return newCard[`owner[${key}]`] = val;\r\n        else if (key === 'address') {\r\n          forEach(val, (aVal, aKey) => {\r\n            if (hopArr(['postal_code', 'city', 'country', 'line1', 'line2', 'state'], aKey)) {\r\n              return newCard[`owner[address][${aKey}]`] = aVal;\r\n            }\r\n          })\r\n        }\r\n        else if (key === 'metadata') {\r\n          forEach(val, (mVal, mKey) => (newCard[`metadata[${key}]`] = val))\r\n        }\r\n      });\r\n    }\r\n\r\n    /* Send Request */\r\n    return new this.$q((success, fail) => {\r\n      const create3DSecureCallback = this.create3DSecure(requestObject, success, fail)\r\n      return this.httpService.doRequest({\r\n        data: newCard,\r\n        url: '/sources',\r\n        method: 'POST'\r\n      }, create3DSecureCallback)\r\n    })\r\n  }\r\n\r\n  create3DSecure(requestObject, success, fail) {\r\n    return (status, cardResponse) => {\r\n      if (status !== 200 || cardResponse.error) {\r\n        return fail(cardResponse.error || cardResponse)\r\n      }\r\n      \r\n      if (cardResponse.card.three_d_secure === 'not_supported' && cardResponse.status === 'chargeable') {\r\n        return success(cardResponse);\r\n      }\r\n      if (cardResponse.card.three_d_secure === 'optional' || cardResponse.card.three_d_secure === 'required') {\r\n        const _3D = extend({}, {\r\n          amount:   this.defaults.add_card_amount,\r\n          currency: this.defaults.currency\r\n        }, {\r\n          type: 'three_d_secure',\r\n          three_d_secure: { card: cardResponse.id },\r\n          redirect: {\r\n            return_url: ( requestObject.redirect_url || this.defaults.redirect_url )\r\n          }\r\n        });\r\n        const stripe3dsCallback = this.makeIFrame(requestObject, success, fail);\r\n        return this.httpService.doRequest({\r\n          data: _3D,\r\n          url: '/sources',\r\n          method: 'POST'\r\n        }, stripe3dsCallback);\r\n      }\r\n      return fail(cardResponse);\r\n    }\r\n  }\r\n\r\n  authSource(requestObject, success, fail) {\r\n    /* Working ON it*/\r\n    return (status, cardResponse) => {\r\n      const charge = {\r\n        id: cardResponse.id,\r\n        amount: this.defaults.add_card_amount\r\n      };\r\n      return this.httpService.doRequest({\r\n        data: charge,\r\n        method: 'POST',\r\n        url: '/charges'\r\n      })\r\n      .then(r => success(r.data))\r\n      .catch(r => fail(r.error))\r\n    }\r\n    // .then(R => success(R.data))\r\n    // .catch(ERR => fail(ERR.error));\r\n  }\r\n\r\n  makeIFrame(requestObject, success, fail) {\r\n    return (status, stripe3dsResponse) => {\r\n      if (status !== 200 || stripe3dsResponse.error) {\r\n        return fail(stripe3dsResponse.error || stripe3dsResponse)\r\n      }\r\n      var tElm = requestObject.targetElement;\r\n      if (!tElm) {\r\n        tElm = angular.element('<div></div>')[0]\r\n        angular.element('body').append(tElm)\r\n      }\r\n      tElm.innerHTML = `<iframe style=\"width:100%; height: 300px;\" frameborder=\"0\" src=\"${stripe3dsResponse.redirect.url}\"></iframe>`;\r\n      requestObject.nativeElement = tElm;\r\n      const poolingCallback = this.poolCallback(requestObject, success, fail);\r\n      return this.watchSource(stripe3dsResponse.id, stripe3dsResponse.client_secret, poolingCallback);\r\n    }\r\n  }\r\n\r\n  watchSource (id, client_secret, onFinish) {\r\n    return this.httpService.doRequest({\r\n      url: `/sources/${id}?key=${this.stripeConfig.key}&client_secret=${client_secret}`\r\n    })\r\n    .then(R => {\r\n      const source = R.data;\r\n      if (source.status === 'pending') return false;\r\n      return onFinish(R.status, source)\r\n    })\r\n    .then(source => {\r\n      if (source === false) return this.watchSource(id, client_secret, onFinish);\r\n      return source;\r\n    })\r\n    .catch(error => onFinish(400, { error }));\r\n  }\r\n\r\n  poolCallback(requestObject, success, fail) {\r\n    return (status, source) => {\r\n      if (status !== 200 || source.error) {\r\n        return fail(source.error)\r\n      }\r\n      else if (source.status === 'canceled' || source.status === 'consumed' || source.status === 'failed') {\r\n        requestObject.nativeElement.innerHTML = \"\";\r\n        fail(source.status);\r\n      }\r\n      else if (/* source.three_d_secure.authenticated && */ source.status === 'chargeable') {\r\n        /* some cards do not need to be authenticated, like the 4242 4242 4242 4242 */\r\n        requestObject.nativeElement.innerHTML = \"\";\r\n        success(source)\r\n      }\r\n    }\r\n  }\r\n\r\n  /* End of class */\r\n}\r\n\r\nstripeSource.$inject = ['httpService', 'stripeConfig', '$q'];\r\n\r\nexport default stripeSource;\r\n\n\n\n// WEBPACK FOOTER //\n// ./src/providers/stripe/stripe.source.service.js","import { addCard } from \"./directives\";\r\n\r\nexport default angular.module('stripe.directives', [])\r\n  .directive('createSourceToStripe', addCard.Factory)\r\n  ;\n\n\n// WEBPACK FOOTER //\n// ./src/providers/stripe/stripe.directives.js","import addCard from \"./add-card\"\r\nconst defMap = { addCard };\r\n\r\nexport {\r\n  addCard,\r\n  defMap as default\r\n}\n\n\n// WEBPACK FOOTER //\n// ./src/providers/stripe/directives/index.js","\r\nclass addCard {\r\n  constructor(stripeSource) {\r\n    this.restrict = 'EA';\r\n    this.stripeSource = stripeSource;\r\n    this.scope = { source: '=', onSuccess: '&', onFail: '&' }\r\n    this.template = '<div><button ng-click=\"save()\">Save to Stripe</button></div>';\r\n  }\r\n  link($scope, iElm, iAttrs) {\r\n    $scope.onFail = $scope.onFail || angular.noop;\r\n    $scope.onSuccess = $scope.onSuccess || angular.noop;\r\n    $scope.source.targetElement = $scope.source.targetElement;\r\n    if (!$scope.source.targetElement) {\r\n      $scope.source.targetElement = angular.element('<div>')[0];\r\n      iElm.append($scope.source.targetElement)\r\n    }\r\n    $scope.save = () => {\r\n      this.stripeSource.createCard($scope.source)\r\n        .then(source => $scope.onSuccess({source}))\r\n        .catch(error => $scope.onFail({error}))        \r\n    }\r\n  }\r\n  static Factory(stripeSource) {\r\n    return new addCard(stripeSource);\r\n  }\r\n}\r\naddCard.Factory.$inject = ['stripeSource'];\r\nexport default addCard;\r\n\n\n\n// WEBPACK FOOTER //\n// ./src/providers/stripe/directives/add-card.js"],"sourceRoot":""}